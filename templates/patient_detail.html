{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

    <h2 class="mb-4 text-primary">üëÅÔ∏è Patient Full Details</h2>

    <!-- Patient Info -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">Personal Information</div>
        <div class="card-body">
            <p><strong>ID:</strong> {{ patient.patient_id or '-' }}</p>
            <p><strong>Name:</strong> {{ patient.first_name or '-' }} {{ patient.last_name or '-' }}</p>
            <p><strong>Gender:</strong> {{ patient.gender or '-' }}</p>
            <p><strong>Phone:</strong> {{ patient.phone or '-' }}</p>
            <p><strong>Email:</strong> {{ patient.email or '-' }}</p>
            <p><strong>Address:</strong> {{ patient.home_address or '-' }}</p>
            <p><strong>Blood Group:</strong> {{ patient.blood_group or '-' }}</p>
            <p><strong>Genotype:</strong> {{ patient.genotype or '-' }}</p>
            <p><strong>Registration Date:</strong> {{ patient.registration_date or '-' }}</p>
            <p><strong>Folder Number:</strong> {{ patient.folder_number or '-' }}</p>
            <p><strong>Folder Status:</strong> {{ patient.folder_status or '-' }}</p>
            <p><strong>Folder Created:</strong> {{ patient.folder_date or '-' }}</p>
        </div>
    </div>

    <!-- Medical History -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">Medical History</div>
        <div class="card-body">
            {% if patient.condition %}
                <p><strong>Condition:</strong> {{ patient.condition }}</p>
                <p><strong>Diagnosis Date:</strong> {{ patient.diagnosis_date or '-' }}</p>
                <p><strong>Under Medication:</strong> {{ patient.under_medication or '-' }}</p>
                <p><strong>Notes:</strong> {{ patient.history_notes or '-' }}</p>
            {% else %}
                <p class="text-muted">No medical history available.</p>
            {% endif %}
        </div>
    </div>

    <!-- Visits & Prescriptions -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">Visits & Prescriptions</div>
        <div class="card-body">
            {% if visits %}
                <table class="table table-bordered table-striped">
                    <thead class="table-light">
                        <tr>
                            <th>Visit Date</th>
                            <th>Doctor</th>
                            <th>Diagnosis</th>
                            <th>Treatment</th>
                            <th>Visual Acuity (L/R)</th>
                            <th>IOP</th>
                            <th>Follow-up</th>
                            <th>Drug</th>
                            <th>Dosage</th>
                            <th>Duration</th>
                            <th>Prescription Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for v in visits %}
                        <tr>
                            <td>{{ v.visit_date or '-' }}</td>
                            <td>{{ v.doctor_name or '-' }} {% if v.specialization %}({{ v.specialization }}){% endif %}</td>
                            <td>{{ v.diagnosis or '-' }}</td>
                            <td>{{ v.treatment or '-' }}</td>
                            <td>
                                {% if v.visual_acuity_left is not none and v.visual_acuity_right is not none %}
                                    {{ v.visual_acuity_left }} / {{ v.visual_acuity_right }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>{{ v.intraocular_pressure or '-' }}</td>
                            <td>{{ v.follow_up_date or '-' }}</td>
                            <td>{{ v.drug_name or '-' }}</td>
                            <td>{{ v.dosage or '-' }}</td>
                            <td>{{ v.duration or '-' }}</td>
                            <td>{{ v.prescription_notes or '-' }}</td>
                            <td>
                                {% if v.visit_id %}
                                    <form action="{{ url_for('delete_visit', visit_id=v.visit_id, patient_id=patient.patient_id) }}" method="POST" style="display:inline;">
                                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this visit?');">
                                            Delete
                                        </button>
                                    </form>
                                {% else %}
                                    <span class="text-muted">No actions</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="text-muted">No visits or prescriptions found.</p>
            {% endif %}
        </div>
    </div>

   <form action="{{ url_for('delete_patient', patient_id=patient.patient_id) }}" method="POST">
    <button class="btn btn-danger" onclick="return confirm('Delete this patient and all records?');">
        Delete Patient
    </button>
</form>

</div>

{% endblock %}
